<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>STERLA - COMPLETE AI LEARNING APP</title>
<style>
:root{
--black:#0b0b0d; --card:#111216; --light-blue:#84d2ff; --light-purple:#c2b3ff;
--muted:#9aa0b4; --white:#ffffff; --success:#3cd48b; --danger:#e55a5a;
}
*{box-sizing:border-box;font-family:Inter,Poppins,sans-serif;}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#0b0b0d 0%,#0f1724 100%);color:var(--white);}
#appPage{height:100vh;display:flex;overflow:hidden}
#sidebar{width:260px;background:linear-gradient(180deg,#071028,#0b1633);padding:28px;color:var(--white);border-right:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:14px;flex-shrink:0}
.brand{font-size:28px;font-weight:800;color:var(--light-purple);letter-spacing:1px}
.nav-btn{background:transparent;border:none;color:var(--muted);padding:12px 14px;text-align:left;border-radius:10px;cursor:pointer;font-weight:700;width:100%;margin:0}
.nav-btn.active, .nav-btn:hover{background:rgba(255,255,255,0.02);color:var(--white);box-shadow:0 6px 20px rgba(124,107,255,0.08)}
#main{flex:1;overflow:auto;padding:30px;background:linear-gradient(180deg,#0b0f1a 0%,#0b1220 30%);display:flex;flex-direction:column}
#welcomeBox{background:linear-gradient(180deg,#071028,#0b1430);border-radius:16px;padding:26px;color:var(--white);display:flex;justify-content:space-between;align-items:center;gap:20px;margin-bottom:20px;flex-shrink:0}
#welcomeBox h2{color:var(--light-blue);font-size:22px;margin:0}
#welcomeBox p{margin:0;color:var(--muted)}
.subject-grid{display:flex;flex-wrap:wrap;gap:18px}
.subject-card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:20px;border-radius:14px;width:200px;cursor:pointer;box-shadow:0 10px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.02);font-weight:800;color:var(--light-blue);text-align:center;transition:all 0.3s}
.subject-card:hover{transform:translateY(-6px);box-shadow:0 18px 50px rgba(6,10,40,0.8)}
.page{display:none;flex:1}
.page.active{display:flex;flex-direction:column}
.output-box{background:linear-gradient(180deg,#061022,#081428);padding:18px;border-radius:14px;border:1px solid rgba(255,255,255,0.02);color:var(--white);flex:1}
.flow-controls{display:flex;gap:12px;align-items:center;margin-bottom:20px;flex-wrap:wrap}
.flow-controls select,.flow-controls button{padding:10px 16px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:var(--white);font-weight:600}
.flow-controls button{background:linear-gradient(90deg,var(--light-blue),var(--light-purple));border:none;cursor:pointer}
.flow-controls button:hover,.flow-controls button:active{transform:translateY(-2px)}
.flow-node{fill:#071f35;stroke:var(--light-blue);stroke-width:3px;rx:12;ry:12;cursor:pointer;transition:all 0.3s}
.flow-node:hover{fill:#0a2a4a;stroke:var(--light-purple);stroke-width:4px;transform:translateY(-2px)}
.flow-text{fill:var(--white);font-family:Inter,sans-serif;font-weight:600;font-size:14px;text-anchor:middle;pointer-events:none}
.flow-line{stroke:var(--light-purple);stroke-width:3px;stroke-linecap:round;fill:none;filter:drop-shadow(0 2px 4px rgba(132,210,255,0.3))}
.quiz-btn{margin:8px;padding:12px 20px;border-radius:8px;border:1px solid var(--light-blue);background:transparent;color:var(--light-blue);cursor:pointer;font-weight:600}
.quiz-btn:hover{background:var(--light-blue);color:#001}
.quiz-btn.correct{background:var(--success);color:#000}
.quiz-btn.wrong{background:var(--danger);color:#fff}
#chatBox{background:#061025;padding:12px;border-radius:12px;min-height:360px;max-height:520px;overflow:auto;border:1px solid rgba(255,255,255,0.02);flex:1}
.chat-input{margin-top:12px;display:flex;gap:12px}
.chat-input input{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff}
.chat-input button{padding:10px 16px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--light-blue),var(--light-purple));color:#001;font-weight:800}
.btn{width:200px;padding:12px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--light-blue),var(--light-purple));color:#001;cursor:pointer;font-weight:700;margin-top:20px}
.hw-submit{display:flex;flex-direction:column;gap:12px}
.hw-submit textarea{flex:1;padding:15px;border-radius:12px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.02);color:var(--white);font-family:monospace;resize:vertical;min-height:120px}
.hw-item{background:rgba(255,255,255,0.05);padding:16px;border-radius:12px;border-left:4px solid var(--light-purple);margin-bottom:12px}
.hw-item.graded{padding-left:12px;border-left-color:var(--success)}
.hw-item.rejected{border-left-color:var(--danger)}
.role-indicator{background:var(--light-purple);color:#000;padding:6px 12px;border-radius:20px;font-size:14px;font-weight:600;display:inline-block}
.role-toggle{position:fixed;top:20px;right:20px;z-index:1000;display:flex;gap:12px;background:rgba(255,255,255,0.05);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.1)}
.role-toggle button{flex:1;padding:12px;border-radius:10px;font-weight:700;cursor:pointer;border:none;transition:all 0.3s;font-size:14px}
.role-toggle button.student-role{background:var(--success);color:#000}
.role-toggle button.teacher-role{background:var(--light-purple);color:#000}
.role-toggle button:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(132,210,255,0.3)}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:26px;padding:10px 18px;border-radius:999px;font-weight:700;z-index:1000}
.toast.success{background:var(--success);color:#000}
.toast.error{background:var(--danger);color:#fff}
@media (max-width:900px){#sidebar{display:none}#main{padding:18px}.role-toggle{top:10px;right:10px;padding:12px}}
</style>
</head>
<body>

<div id="appPage">
<aside id="sidebar">
<div class="brand">STERLA</div>
<button class="nav-btn active" data-page="homePage" onclick="navigate(event)">üè† Home</button>
<button class="nav-btn" data-page="subjectsPage" onclick="navigate(event)">üìö Subjects</button>
<button class="nav-btn" data-page="topicPage" onclick="navigate(event)">üìñ Topics</button>
<button class="nav-btn" data-page="mindmapPage" onclick="navigate(event)">üìä Flowchart</button>
<button class="nav-btn" data-page="quizPage" onclick="navigate(event)">‚ùì Quiz</button>
<button class="nav-btn" data-page="wsPage" onclick="navigate(event)">üìù Worksheet</button>
<button class="nav-btn" data-page="hwPage" onclick="navigate(event)">‚úèÔ∏è Homework</button>
<button class="nav-btn" data-page="aiChatPage" onclick="navigate(event)">üí¨ AI Chat</button>
<div style="flex:1"></div>
<div style="padding:12px 0;color:var(--muted);font-size:14px;text-align:center;border-top:1px solid rgba(255,255,255,0.05)">
<span id="roleIndicator" class="role-indicator">Student</span>
</div>
</aside>

<div class="role-toggle">
<button class="student-role" onclick="switchRole('Student')">üë®‚Äçüéì Student</button>
<button class="teacher-role" onclick="switchRole('Teacher')">üë©‚Äçüè´ Teacher</button>
</div>

<main id="main">
<section id="homePage" class="page active">
<div id="welcomeBox">
<div>
<h2>Welcome to STERLA</h2>
<p>Your AI learning companion</p>
</div>
<div style="text-align:right;color:var(--muted)">
<div id="welcomeUser">Student</div>
</div>
</div>
<h3 style="color:var(--light-blue);margin:8px 0 20px 0">Quick Subjects (23 Topics)</h3>
<div class="subject-grid" id="subjectsQuick"></div>
</section>

<section id="subjectsPage" class="page">
<h3 style="color:var(--light-blue);margin-bottom:20px">All 23 Subjects</h3>
<div class="subject-grid" id="subjectsList"></div>
</section>

<section id="topicPage" class="page">
<h3 style="color:var(--light-blue);margin-bottom:20px">Topics</h3>
<div class="subject-grid" id="topicsList"></div>
</section>

<section id="mindmapPage" class="page">
<h3 style="color:var(--light-blue);margin-bottom:20px">Flowchart Generator</h3>
<div class="flow-controls">
<label style="color:var(--light-blue);font-weight:600;margin-right:8px;">Select Topic:</label>
<select id="flowTopicSelect">
<option value="">Choose a subject first...</option>
</select>
<button onclick="generateFlowchart()">Generate Flowchart</button>
</div>
<div id="flowchartStatus" style="color:var(--light-purple);margin-bottom:15px;font-weight:600"></div>
<div id="flowchartContainer" style="background:linear-gradient(180deg,#071427,#02101a);border-radius:14px;padding:20px;overflow:auto;border:1px solid rgba(255,255,255,0.03);flex:1;">
<svg id="flowSvg" width="100%" height="500"></svg>
</div>
</section>

<section id="quizPage" class="page">
<h3 style="color:var(--light-blue);margin-bottom:20px">Quiz</h3>
<div id="quizStatus" style="color:var(--light-purple);margin-bottom:15px;font-weight:600"></div>
<div id="quizOutput" class="output-box"></div>
<button class="btn" onclick="loadQuiz()">Reload Quiz</button>
</section>

<section id="wsPage" class="page">
<h3 style="color:var(--light-blue);margin-bottom:20px">Worksheet</h3>
<div id="wsStatus" style="color:var(--light-purple);margin-bottom:15px;font-weight:600"></div>
<div id="wsOutput" class="output-box"></div>
<button class="btn" onclick="loadWorksheet()">Reload Worksheet</button>
</section>

<section id="hwPage" class="page">
<h3 style="color:var(--light-blue);margin-bottom:20px">Homework <span id="hwRoleIndicator"></span></h3>
<div id="hwStatus" style="color:var(--light-purple);margin-bottom:15px;font-weight:600"></div>
<div id="hwOutput" class="output-box" style="display:flex;flex-direction:column;gap:20px"></div>
</section>

<section id="aiChatPage" class="page">
<h3 style="color:var(--light-blue);margin-bottom:20px">AI Chat <span style="color:var(--muted);font-size:16px">(Topic-aware)</span></h3>
<div id="chatBox"></div>
<div class="chat-input">
<input type="text" id="chatInput" placeholder="Ask about your selected topic..." />
<button onclick="sendMessage()">Send</button>
</div>
</section>
</main>
</div>

<script>
// GLOBAL STATE
let userName = 'Student', userRole = 'Student';
let selectedSubject = null, chosenTopic = null;

// 23 FULL SUBJECTS
const subjects = [
  "Grammar","Formal Letter","Speech","Prose","Poetry","Essay Writing","Comprehension",
  "Algebra","Linear Equations","Quadratic Equations","Mensuration","Geometry","Trigonometry",
  "Sound","Electricity","Light","Force & Motion","Reproduction","Nutrition",
  "HTML","CSS","JavaScript","AI Basics","Data Science"
];

// COMPREHENSIVE DATA BANKS FOR ALL 23 TOPICS
const subjectTopics = {
  "Grammar": ["Grammar"], "Formal Letter": ["Formal Letter"], "Speech": ["Speech"], "Prose": ["Prose"],
  "Poetry": ["Poetry"], "Essay Writing": ["Essay Writing"], "Comprehension": ["Comprehension"],
  "Algebra": ["Algebra"], "Linear Equations": ["Linear Equations"], "Quadratic Equations": ["Quadratic Equations"],
  "Mensuration": ["Mensuration"], "Geometry": ["Geometry"], "Trigonometry": ["Trigonometry"],
  "Sound": ["Sound"], "Electricity": ["Electricity"], "Light": ["Light"], "Force & Motion": ["Force & Motion"],
  "Reproduction": ["Reproduction"], "Nutrition": ["Nutrition"],
  "HTML": ["HTML"], "CSS": ["CSS"], "JavaScript": ["JavaScript"], 
  "AI Basics": ["AI Basics"], "Data Science": ["Data Science"]
};

// FLOWCHART DATA FOR 23 TOPICS
const flowchartBank = {
  "Grammar":["Parts of Speech","Nouns & Verbs","Adjectives","Sentence Structure","Tenses","Punctuation"],
  "Formal Letter":["Format","Salutation","Body","Closing","Signature"],
  "Speech":["Introduction","Main Points","Conclusion","Delivery Tips"],
  "Prose":["Main Idea","Characters","Plot","Theme","Literary Devices"],
  "Poetry":["Rhyme Scheme","Meter","Imagery","Tone","Structure"],
  "Essay Writing":["Thesis","Introduction","Body Paragraphs","Conclusion"],
  "Comprehension":["Skimming","Scanning","Main Idea","Inference"],
  "Algebra":["Variables","Expressions","Equations","Inequalities","Functions"],
  "Linear Equations":["Standard Form","Slope Intercept","Graphing","Systems"],
  "Quadratic Equations":["Factoring","Quadratic Formula","Discriminant","Graphing"],
  "Mensuration":["Area Formulas","Volume Formulas","Surface Area"],
  "Geometry":["Triangles","Circles","Polygons","Theorems"],
  "Trigonometry":["Sine Cosine","Tan Identities","Triangles"],
  "Sound":["Waves","Frequency","Pitch","Echo"],
  "Electricity":["Current","Voltage","Resistance","Circuits"],
  "Light":["Reflection","Refraction","Lenses","Colors"],
  "Force & Motion":["Newton's Laws","Acceleration","Friction"],
  "Reproduction":["Asexual","Sexual","Human System"],
  "Nutrition":["Carbohydrates","Proteins","Vitamins","Diet"],
  "HTML":["Tags","Elements","Attributes","Structure"],
  "CSS":["Selectors","Properties","Box Model","Flexbox"],
  "JavaScript":["Variables","Functions","Events","DOM"],
  "AI Basics":["Machine Learning","Neural Networks","Data","Ethics"],
  "Data Science":["Data Cleaning","Visualization","Modeling","Insights"]
};

// QUIZ DATA FOR 23 TOPICS (2 questions each)
const quizBank = {
  "Grammar":[{"q":"What describes a noun?","options":["Adjective","Verb","Noun","Adverb"],"answer":"Adjective"},
            {"q":"Tenses show?","options":["Time","Place","Person","Number"],"answer":"Time"}],
  "Formal Letter":[{"q":"Letter starts with?","options":["Date","Dear Sir","Subject","Yours"],"answer":"Date"},
                  {"q":"Ends with?","options":["Yours faithfully","Dear Sir","Subject","Address"],"answer":"Yours faithfully"}],
  "Speech":[{"q":"Speech needs?","options":["Introduction","Long words","Memorizing","Shouting"],"answer":"Introduction"},
           {"q":"Good speech has?","options":["Conclusion","Jokes","Stories","Facts"],"answer":"Conclusion"}],
  "Prose":[{"q":"Prose has?","options":["Characters","Rhyme","Meter","Stanzas"],"answer":"Characters"},
          {"q":"Main idea is?","options":["Theme","Plot","Setting","Conflict"],"answer":"Theme"}],
  "Poetry":[{"q":"Rhyme is?","options":["Sound match","Word match","Letter match","Syllable"],"answer":"Sound match"},
           {"q":"Poetry uses?","options":["Imagery","Prose","Dialogue","Lists"],"answer":"Imagery"}],
  "Essay Writing":[{"q":"Essay needs?","options":["Thesis","Poem","Story","Letter"],"answer":"Thesis"},
                  {"q":"Body has?","options":["Arguments","Introduction","Conclusion"],"answer":"Arguments"}],
  "Comprehension":[{"q":"Skimming finds?","options":["Main idea","Details","Examples"],"answer":"Main idea"},
                  {"q":"Inference uses?","options":["Text clues","Memories","Guesses"],"answer":"Text clues"}],
  "Algebra":[{"q":"x + 5 = 10, x=?","options":["5","15","10","0"],"answer":"5"},
            {"q":"2x = 8, x=?","options":["4","16","2","8"],"answer":"4"}],
  "Linear Equations":[{"q":"y = mx + c is?","options":["Line","Circle","Parabola"],"answer":"Line"},
                     {"q":"Slope means?","options":["Steepness","Curve","Intercept"],"answer":"Steepness"}],
  "Quadratic Equations":[{"q":"x¬≤ form?","options":["Parabola","Line","Circle"],"answer":"Parabola"},
                        {"q":"Roots from?","options":["Formula","Addition"],"answer":"Formula"}],
  "Mensuration":[{"q":"Area of rectangle?","options":["l√ów","l+w","l/w"],"answer":"l√ów"},
                {"q":"Volume cube?","options":["l¬≥","l¬≤","l"],"answer":"l¬≥"}],
  "Geometry":[{"q":"Triangle angles?","options":["180¬∞","360¬∞","90¬∞"],"answer":"180¬∞"},
             {"q":"Circle has?","options":["360¬∞","180¬∞","90¬∞"],"answer":"360¬∞"}],
  "Trigonometry":[{"q":"sin 90¬∞?","options":["1","0","0.5"],"answer":"1"},
                 {"q":"SOH CAH TOA?","options":["Trig ratios","Angles","Sides"],"answer":"Trig ratios"}],
  "Sound":[{"q":"Pitch from?","options":["Frequency","Amplitude"],"answer":"Frequency"},
          {"q":"Echo needs?","options":["Reflection","Absorption"],"answer":"Reflection"}],
  "
